---
# SPDX-License-Identifier: EUPL-1.2
# SPDX-FileCopyrightText: 2025-present JÃ¼rgen MÃ¼lbert <juergen.muelbert@gmail.com>

name: Issue Management

# yamllint disable-line rule:truthy
on:
  issues:
    types: [opened, labeled, unlabeled, assigned, reopened]
  issue_comment:
    types: [created]
  workflow_dispatch:

defaults:
  run:
    shell: bash

concurrency:
  group: ${{ github.workflow }}-${{ github.event.issue.number }}
  cancel-in-progress: true

jobs:
  process-issue:
    name: Process Issue
    if: github.actor != 'dependabot[bot]'
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read # For checkout
      issues: write # For labels, comments, etc.
      pull-requests: read
      security-events: write
      pages: write
      id-token: write

    outputs:
      labeled: ${{ steps.triage.outputs.labeled }}
      priority: ${{ steps.triage.outputs.priority }}

    steps:
      - name: ðŸ”’ Harden Runner
        uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          egress-policy: audit

      - name: ðŸ§° Checkout Repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: ðŸš€ Run Issue Automation
        id: triage
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          # Use a separate file for the script to improve readability and maintainability
          script: |
            const script = require('./.github/scripts/issue-handler.js');
            await script.default({ github, context, core, ${{env.GITHUB_WORKSPACE }});
