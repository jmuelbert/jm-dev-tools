---
# SPDX-License-Identifier: EUPL-1.2
# SPDX-FileCopyrightText: 2025-present JÃ¼rgen MÃ¼lbert <juergen.muelbert@gmail.com>

name: Repository Maintenance

# yamllint disable-line rule:truthy
on:
  schedule:
    - cron: 0 0 * * 0 # Run at midnight every Sunday
  workflow_dispatch:

defaults:
  run:
    shell: bash

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  repolinter-action:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    permissions:
      contents: read
      
    steps:
      - name: ðŸ”’ Harden Runner
        uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          egress-policy: audit

      - name: ðŸ§° Checkout Repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: Run Repolinter
        uses: newrelic/repolinter-action@3f4448f855c351e9695b24524a4111c7847b84cb # v1.7.0

  maintenance:
    name: Repository Cleanup
    runs-on: ubuntu-latest
    timeout-minutes: 30
    permissions:
      contents: write
      issues: write
      pull-requests: write

    steps:
      - name: ðŸ”’ Harden Runner
        uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          egress-policy: audit

      - name: ðŸ§° Checkout Repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          fetch-depth: 0
          persist-credentials: false

      - name: ðŸ§¹ Process Stale Items
        id: stale
        uses: actions/stale@997185467fa4f803885201cee163a9f38240193d # v10.1.1
        with:
          stale-issue-message: |
            This issue has been automatically marked as stale due to 30 days of inactivity.
            It will be closed in 5 days if no further activity occurs.

            - Comment or update to keep this open
            - Remove `stale` label to prevent closure
            - Close this issue if it's resolved
          close-issue-message: |
            This issue has been closed due to inactivity.
            Please reopen if still relevant.

          stale-pr-message: |
            This PR has been marked as stale due to 45 days of inactivity.
            It will be closed in 10 days if no further activity occurs.

            - Comment or update to keep this open
            - Remove `stale` label to prevent closure
          close-pr-message: |
            This PR has been closed due to inactivity.
            Feel free to reopen if you'd like to continue working on it.

          days-before-issue-stale: 30
          days-before-pr-stale: 45
          days-before-issue-close: 5
          days-before-pr-close: 10

          stale-issue-label: stale
          stale-pr-label: stale

          exempt-issue-labels: |
            security
            pinned
            bug
            enhancement
          exempt-pr-labels: |
            security
            pinned
            dependencies

          delete-branch: true
          enable-statistics: true
